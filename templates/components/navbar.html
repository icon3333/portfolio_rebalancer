<nav class="navbar" role="navigation" aria-label="main navigation" style="background-color: var(--bg);">
    <div class="navbar-brand">
        <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasic">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
    </div>

    <div id="navbarBasic" class="navbar-menu">
        <div class="navbar-start">
            <!-- Navigation items can be added here if needed -->
        </div>

        <div class="navbar-end">
            <!-- Create Account button moved to landing page -->
            {% if session.account_id %}
            <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link">
                    <span class="icon has-text-primary">
                        <i class="fas fa-user"></i>
                    </span>
                    <span>{{ session.username }}</span>
                </a>

                <div class="navbar-dropdown is-right">
                    <a class="navbar-item" href="{{ url_for('account.index') }}">
                        <span class="icon">
                            <i class="fas fa-cog"></i>
                        </span>
                        <span>Account Settings</span>
                    </a>
                    <hr class="navbar-divider">
                    <a class="navbar-item" href="{{ url_for('main.clear_account') }}">
                        <span class="icon">
                            <i class="fas fa-sign-out-alt"></i>
                        </span>
                        <span>Exit Account</span>
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</nav>

{% if not session.account_id %}
<!-- Create Account Modal -->
<div id="create-account-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">Create New Account</p>
            <button class="delete" aria-label="close"></button>
        </header>
        <form action="{{ url_for('account.create_account') }}" method="post">
            <section class="modal-card-body">
                <div class="field">
                    <label class="label">Username</label>
                    <div class="control has-icons-left">
                        <input class="input" type="text" name="username" placeholder="Enter username" required>
                        <span class="icon is-small is-left">
                            <i class="fas fa-user"></i>
                        </span>
                    </div>
                    <p class="help">Choose a unique username for your account</p>
                </div>
            </section>
            <footer class="modal-card-foot">
                <button type="submit" class="button is-primary">Create Account</button>
                <button type="button" class="button modal-cancel">Cancel</button>
            </footer>
        </form>
    </div>
</div>
{% endif %}

<!-- Mobile Navigation JS -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Functions to open and close a modal
        function openModal($el) {
            $el.classList.add('is-active');
        }

        function closeModal($el) {
            $el.classList.remove('is-active');
        }

        function closeAllModals() {
            (document.querySelectorAll('.modal') || []).forEach(($modal) => {
                closeModal($modal);
            });
        }

        // Add a click event on buttons to open a specific modal
        (document.querySelectorAll('.js-modal-trigger') || []).forEach(($trigger) => {
            const modal = $trigger.dataset.target;
            const $target = document.getElementById(modal);

            $trigger.addEventListener('click', () => {
                openModal($target);
            });
        });

        // Add a click event on various child elements to close the parent modal
        (document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, .modal-cancel') || []).forEach(($close) => {
            const $target = $close.closest('.modal');

            $close.addEventListener('click', () => {
                closeModal($target);
            });
        });

        // Navbar burger toggle
        const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

        if ($navbarBurgers.length > 0) {
            $navbarBurgers.forEach(el => {
                el.addEventListener('click', () => {
                    const target = el.dataset.target;
                    const $target = document.getElementById(target);

                    el.classList.toggle('is-active');
                    $target.classList.toggle('is-active');
                });
            });
        }
    });
</script>